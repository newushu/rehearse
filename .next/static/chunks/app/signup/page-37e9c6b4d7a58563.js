(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{8318:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),a=r(2619),n=r.n(a),i=r(2115),l=r(9815),o=r(6979);function d(e){let{performanceId:t,studentId:r,studentName:a}=e,[n,l]=(0,i.useState)([]),[d,c]=(0,i.useState)(!0),[x,g]=(0,i.useState)(0),m=(0,i.useCallback)(async()=>{try{c(!0);let e=await fetch("/api/performances/".concat(t)),s=await e.json();if(!s.parts||0===s.parts.length)return void l([]);let a=[];for(let e of s.parts){let t=await fetch("/api/stage-positions?partId=".concat(e.id)),s=(await t.json()).find(e=>e.student_id===r);a.push({part_name:e.name,part_id:e.id,x:(null==s?void 0:s.x)||0,y:(null==s?void 0:s.y)||0,positioned:!!s})}l(a)}catch(e){console.error("Error fetching positions:",e)}finally{c(!1)}},[t,r]);if((0,i.useEffect)(()=>{m()},[m]),d)return(0,s.jsx)("div",{className:"text-center py-8",children:"Loading your positions..."});if(0===n.length)return(0,s.jsx)("div",{className:"text-center py-8 text-gray-600",children:(0,s.jsx)("p",{children:"No positioning information available for this performance."})});let p=n[x];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(o.v,{size:28,className:"border border-blue-200 bg-white text-blue-400"}),(0,s.jsxs)("h2",{className:"font-bold text-lg text-gray-900",children:["Your Position for ",a]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"View your position on stage for each part of the choreography"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"All Parts"}),(0,s.jsx)("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:n.map((e,t)=>(0,s.jsxs)("button",{onClick:()=>g(t),className:"w-full text-left px-3 py-2 rounded transition-colors ".concat(x===t?"bg-blue-600 text-white font-semibold":"bg-white text-gray-900 hover:bg-gray-100"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.part_name}),e.positioned?(0,s.jsx)("span",{className:"text-sm",children:"✓"}):(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"—"})]}),e.positioned&&(0,s.jsxs)("div",{className:"text-xs mt-1 opacity-75",children:["Position: (",e.x,", ",e.y,")"]})]},e.part_id))})]})}),(0,s.jsx)("div",{className:"lg:col-span-3",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg border border-gray-200 space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-lg text-gray-900",children:p.part_name}),p.positioned?(0,s.jsx)("p",{className:"text-sm text-green-700",children:"✓ You are positioned in this part"}):(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Not positioned in this part"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>g(Math.max(0,x-1)),disabled:0===x,className:"px-3 py-2 bg-gray-300 text-gray-900 rounded hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed",children:"← Prev"}),(0,s.jsx)("button",{onClick:()=>g(Math.min(n.length-1,x+1)),disabled:x===n.length-1,className:"px-3 py-2 bg-gray-300 text-gray-900 rounded hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next →"})]})]}),p.positioned?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"border-2 border-gray-400 bg-gradient-to-b from-amber-100 to-amber-50 relative",style:{width:400,height:400,backgroundImage:"\n                      linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),\n                      linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px)\n                    ",backgroundSize:"".concat(40,"px ").concat(40,"px")},children:(0,s.jsx)("div",{className:"absolute flex items-center justify-center",style:{left:40*p.x,top:40*p.y,width:40,height:40},children:(0,s.jsx)("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 border-green-600",children:a.charAt(0).toUpperCase()})})}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Your position: Grid (",p.x,", ",p.y,")"]})]}):(0,s.jsxs)("div",{className:"p-8 bg-gray-50 rounded-lg text-center",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"You are not positioned for this part yet."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Check back after rehearsal when positioning is complete."})]})]})})]})]})}var c=r(1517),x=r(1776),g=r(9157);function m(){let[e,t]=(0,i.useState)("browse"),[r,a]=(0,i.useState)(null),{performances:o,loading:d}=(0,l.f)(),[g,m]=(0,i.useState)(""),[h,b]=(0,i.useState)("");return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("nav",{className:"bg-green-900 text-white p-4 shadow-lg",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[(0,s.jsx)(c.AppBrand,{href:"/"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(n(),{href:"/",className:"hover:bg-green-800 px-3 py-2 rounded",children:"Home"}),(0,s.jsx)("span",{className:"px-3 py-2 bg-green-800 rounded",children:"Student Signup"})]})]})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Sign Up for Performances"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Browse available performances and sign up for your favorite parts"})]}),(0,s.jsxs)("div",{className:"flex gap-4 mb-8",children:[(0,s.jsx)("button",{onClick:()=>t("browse"),className:"px-6 py-3 rounded-lg font-semibold transition-colors ".concat("browse"===e?"bg-green-600 text-white":"bg-white text-gray-900 hover:bg-gray-50"),children:"Browse Performances"}),(0,s.jsx)("button",{onClick:()=>t("mySignups"),className:"px-6 py-3 rounded-lg font-semibold transition-colors ".concat("mySignups"===e?"bg-green-600 text-white":"bg-white text-gray-900 hover:bg-gray-50"),children:"My Sign-ups"}),(0,s.jsx)("button",{onClick:()=>t("schedule"),className:"px-6 py-3 rounded-lg font-semibold transition-colors ".concat("schedule"===e?"bg-green-600 text-white":"bg-white text-gray-900 hover:bg-gray-50"),children:"Schedule"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:["browse"===e&&(0,s.jsx)(p,{performances:o,loading:d,selectedPerformanceId:r,onSelectPerformance:a,studentEmail:g,studentName:h,onStudentEmailChange:m,onStudentNameChange:b}),"mySignups"===e&&(0,s.jsx)(u,{}),"schedule"===e&&(0,s.jsx)(x.z,{title:"Performance Schedule",accent:"green"})]})]})]})}function p(e){let{performances:t,loading:r,selectedPerformanceId:a,onSelectPerformance:n,studentEmail:l,studentName:o,onStudentEmailChange:d,onStudentNameChange:c}=e,[x,m]=(0,i.useState)(null),[p,u]=(0,i.useState)(null),[h,b]=(0,i.useState)(null),[f,y]=(0,i.useState)(null),[j,N]=(0,i.useState)(!1);(0,i.useEffect)(()=>{a&&v(a)},[a]);let v=async e=>{try{let t=await fetch("/api/performances/".concat(e));if(!t.ok)throw Error("Failed to fetch details");let r=await t.json();y(r),b(null)}catch(e){m(e instanceof Error?e.message:"An error occurred")}},w=async e=>{if(e.preventDefault(),m(null),u(null),!o||!l)return void m("Please enter your name and email");if(!a)return void m("Please select a performance");N(!0);try{let e=await fetch("/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,email:l})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to register student")}let t=await e.json();if(!t||!t.id)throw console.error("Invalid student response:",t),Error("Invalid student data received");let r=t.id,s=await fetch("/api/signups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({performance_id:a,student_id:r,part_id:h||null,status:"registered"})});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to sign up")}u("Successfully signed up for the performance!"),b(null),n(null),y(null)}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{N(!1)}};return r?(0,s.jsx)("div",{className:"text-center py-12 text-gray-600",children:"Loading performances..."}):0===t.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"No performances available at the moment."}),(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"Check back soon for upcoming events!"})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Available Performances"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,s.jsxs)("button",{onClick:()=>n(e.id),className:"w-full p-4 text-left border-2 rounded-lg transition-colors ".concat(a===e.id?"border-green-600 bg-green-50":"border-gray-200 hover:border-green-400"),children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.title}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[(0,s.jsxs)("div",{children:["\uD83D\uDCC5 ",(0,g.P9)(e.date,e.timezone||"America/New_York")]}),(0,s.jsxs)("div",{children:["\uD83D\uDCCD ",e.location]})]})]},e.id))}),(0,s.jsx)("div",{children:a?(0,s.jsxs)("form",{onSubmit:w,className:"p-6 bg-gray-50 rounded-lg border-2 border-green-200 space-y-4",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Sign Up"}),x&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:x}),p&&(0,s.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded",children:p}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Your Name *"}),(0,s.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Full name",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Email *"}),(0,s.jsx)("input",{type:"email",value:l,onChange:e=>d(e.target.value),placeholder:"your@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Select Part (Optional)"}),(null==f?void 0:f.parts)&&f.parts.length>0?(0,s.jsxs)("select",{value:h||"",onChange:e=>b(e.target.value||null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[(0,s.jsx)("option",{value:"",children:"-- Any Part --"}),f.parts.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}):(0,s.jsx)("div",{className:"w-full px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-600",children:"No parts available for this performance. You can still sign up as a general participant."})]}),(0,s.jsx)("button",{type:"submit",disabled:j,className:"w-full px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:bg-gray-400 transition-colors",children:j?"Signing up...":"Sign Up"})]}):(0,s.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg text-center text-gray-600",children:(0,s.jsx)("p",{children:"Select a performance to sign up"})})})]})]})}function u(e){let{}=e,[t,r]=(0,i.useState)(""),[a,n]=(0,i.useState)([]),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(null),[x,g]=(0,i.useState)(!1),m=async e=>{if(e.preventDefault(),g(!0),c(null),!t.trim())return void c("Please enter your name");o(!0);try{let e=await fetch("/api/students"),r=(await e.json()).find(e=>e.name.toLowerCase()===t.toLowerCase());if(r){let e=await fetch("/api/signups?studentId=".concat(r.id)),t=await e.json(),s=await Promise.all(t.map(async e=>{let t=await fetch("/api/performances/".concat(e.performance_id)),r=await t.json();return{...e,performance:r}}));n(s)}else c('No student found with name "'.concat(t,'"')),n([])}catch(e){c(e instanceof Error?e.message:"Failed to fetch signups")}finally{o(!1)}};return(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"View Your Sign-ups"}),(0,s.jsx)("form",{onSubmit:m,className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value),placeholder:"Enter your full name",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),(0,s.jsx)("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 font-semibold",children:l?"Searching...":"Search"})]})}),d&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:d}),x?l?(0,s.jsx)("div",{className:"text-center py-12 text-gray-600",children:"Loading..."}):0===a.length?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-600",children:"You haven't signed up for any performances yet."})}):(0,s.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,s.jsx)(h,{signup:e,studentName:t},e.id))}):(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,s.jsx)("p",{children:"Enter your name above to view your sign-ups"})})]})}function h(e){var t,r,a,n;let{signup:l,studentName:o}=e,[c,x]=(0,i.useState)([]),[m,p]=(0,i.useState)(!0),[u,h]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1),y=(0,i.useCallback)(async()=>{try{p(!0);let e=await fetch("/api/performances/".concat(l.performance_id)),t=await e.json();if(!t.parts||0===t.parts.length)return void x([]);let r=[];for(let e of t.parts){let t=await fetch("/api/stage-positions?partId=".concat(e.id)),s=await t.json();if(s.some(e=>e.student_id===l.student_id)){let t=s.find(e=>e.student_id===l.student_id);r.push({part_name:e.name,x:t.x,y:t.y,positioned:!0})}else r.push({part_name:e.name,positioned:!1})}x(r)}catch(e){console.error("Error fetching positioning:",e)}finally{p(!1)}},[l.performance_id,l.student_id]);return((0,i.useEffect)(()=>{y()},[y]),b)?(0,s.jsxs)("div",{className:"border border-green-200 rounded-lg bg-white overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-6 bg-green-50 border-b border-green-200 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-bold text-lg text-gray-900",children:(null==(n=l.performance)?void 0:n.title)||"Performance"}),(0,s.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-300 text-gray-900 rounded hover:bg-gray-400",children:"← Back to Signups"})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(d,{performanceId:l.performance_id,studentId:l.student_id,studentName:o})})]}):(0,s.jsxs)("div",{className:"border border-green-200 rounded-lg bg-green-50 overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>h(!u),className:"w-full p-6 text-left hover:bg-green-100 transition-colors",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h3",{className:"font-bold text-lg text-gray-900",children:["Performance: ",(null==(t=l.performance)?void 0:t.title)||"Unknown"]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[(0,s.jsxs)("div",{children:["\uD83D\uDCC5 Date: ",(null==(r=l.performance)?void 0:r.date)?(0,g.P9)(l.performance.date,l.performance.timezone||"America/New_York"):"N/A"]}),(0,s.jsxs)("div",{children:["\uD83D\uDCCD Location: ",(null==(a=l.performance)?void 0:a.location)||"N/A"]}),(0,s.jsxs)("div",{children:["Status: ",(0,s.jsx)("span",{className:"capitalize px-2 py-1 bg-green-200 rounded text-green-900 text-xs font-semibold",children:l.status})]})]})]}),(0,s.jsx)("div",{className:"text-2xl text-gray-600",children:u?"▼":"▶"})]})}),u&&(0,s.jsxs)("div",{className:"border-t border-green-200 p-6 bg-white",children:[l.part&&(0,s.jsxs)("div",{className:"mb-4 pb-4 border-b border-green-200",children:[(0,s.jsx)("span",{className:"font-semibold text-gray-700",children:"Signed Up For Part:"})," ",(0,s.jsx)("span",{className:"text-gray-600 font-medium",children:l.part})]}),c.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-700 mb-3",children:"Your Positioning for Each Part:"}),(0,s.jsx)("div",{className:"space-y-2 mb-4",children:c.map((e,t)=>(0,s.jsxs)("div",{className:"text-sm text-gray-600 p-2 bg-gray-50 rounded",children:[(0,s.jsxs)("span",{className:"font-medium text-gray-900",children:[e.part_name,":"]})," ",e.positioned?(0,s.jsxs)("span",{className:"text-green-700 font-semibold",children:["✓ Grid position (",e.x,", ",e.y,")"]}):(0,s.jsx)("span",{className:"text-gray-500",children:"Not positioned yet"})]},t))}),(0,s.jsx)("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold",children:"View Positioning Grid →"})]})]})]})}},9405:(e,t,r)=>{Promise.resolve().then(r.bind(r,8318))}},e=>{e.O(0,[5481,2590,8441,1255,7358],()=>e(e.s=9405)),_N_E=e.O()}]);