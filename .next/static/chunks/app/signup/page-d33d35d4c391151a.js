(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{8318:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(5155),a=r(2619),n=r.n(a),i=r(2115),l=r(9815),d=r(6979);function o(e){let{performanceId:t,studentId:r,studentName:a}=e,[n,l]=(0,i.useState)([]),[o,c]=(0,i.useState)({}),[m,u]=(0,i.useState)(!0),[x,p]=(0,i.useState)(0),[h,g]=(0,i.useState)(""),[f,b]=(0,i.useState)(""),[y,j]=(0,i.useState)(""),N=(0,i.useRef)(null),[v,_]=(0,i.useState)(1),w=e=>{if(!e)return"?";let t=e.trim().split(/\s+/);return 1===t.length?t[0].slice(0,2).toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()},S=(0,i.useCallback)(async()=>{try{u(!0);let e=await fetch("/api/performances/".concat(t)),s=await e.json();if(g((null==s?void 0:s.title)||""),!s.parts||0===s.parts.length)return void l([]);let a=[],n={};for(let e of s.parts){let t=await fetch("/api/stage-positions?partId=".concat(e.id)),s=await t.json();n[e.id]=(s||[]).map(e=>({student_id:e.student_id,student_name:e.student_name||"Unknown",x:e.x,y:e.y}));let i=s.find(e=>e.student_id===r);a.push({part_name:e.name,part_id:e.id,x:(null==i?void 0:i.x)||0,y:(null==i?void 0:i.y)||0,positioned:!!i})}l(a),c(n);try{let e=await fetch("/api/signups?performanceId=".concat(t,"&studentId=").concat(r));if(e.ok){let t=(await e.json()||[])[0],r=[...s.parts].sort((e,t)=>(e.order||0)-(t.order||0)),a=r.findIndex(e=>e.id===(null==t?void 0:t.part_id));a>=0?j("Order in performance: ".concat(a+1," of ").concat(r.length)):j("")}}catch(e){j("")}try{let e=await fetch("/api/uniform-student?studentId=".concat(r,"&performanceId=").concat(t));if(e.ok){let t=await e.json();(null==t?void 0:t.item_number)&&(null==t?void 0:t.type_name)?b("".concat(t.type_name," • #").concat(t.item_number)):b("")}}catch(e){b("")}}catch(e){console.error("Error fetching positions:",e)}finally{u(!1)}},[t,r]);if((0,i.useEffect)(()=>{S()},[S]),(0,i.useEffect)(()=>{let e=N.current;if(!e)return;let t=()=>{let t=e.clientWidth;t&&_(Math.min(1,t/400))};t();let r=new ResizeObserver(t);return r.observe(e),()=>r.disconnect()},[400]),m)return(0,s.jsx)("div",{className:"text-center py-8",children:"Loading your positions..."});if(0===n.length)return(0,s.jsx)("div",{className:"text-center py-8 text-gray-600",children:(0,s.jsx)("p",{children:"No positioning information available for this performance."})});let A=n[x],k=o[A.part_id]||[];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(d.v,{size:28,className:"border border-blue-200 bg-white text-blue-400"}),(0,s.jsxs)("h2",{className:"font-bold text-lg text-gray-900",children:["Your Position for ",a]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"View your position on stage for each part of the choreography"}),(h||f||y)&&(0,s.jsxs)("div",{className:"mt-3 text-sm text-gray-700 space-y-1",children:[h&&(0,s.jsxs)("div",{children:["Performance: ",(0,s.jsx)("span",{className:"font-semibold",children:h})]}),y&&(0,s.jsx)("div",{children:y}),f&&(0,s.jsxs)("div",{children:["Uniform: ",(0,s.jsx)("span",{className:"font-semibold",children:f})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"All Parts"}),(0,s.jsx)("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:n.map((e,t)=>(0,s.jsxs)("button",{onClick:()=>p(t),className:"w-full text-left px-3 py-2 rounded transition-colors ".concat(x===t?"bg-blue-600 text-white font-semibold":"bg-white text-gray-900 hover:bg-gray-100"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.part_name}),e.positioned?(0,s.jsx)("span",{className:"text-sm",children:"✓"}):(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"—"})]}),e.positioned&&(0,s.jsxs)("div",{className:"text-xs mt-1 opacity-75",children:["Position: (",e.x,", ",e.y,")"]})]},e.part_id))})]})}),(0,s.jsx)("div",{className:"lg:col-span-3",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg border border-gray-200 space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-lg text-gray-900",children:A.part_name}),A.positioned?(0,s.jsx)("p",{className:"text-sm text-green-700",children:"✓ You are positioned in this part"}):(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Not positioned in this part"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>p(Math.max(0,x-1)),disabled:0===x,className:"px-3 py-2 bg-gray-300 text-gray-900 rounded hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed",children:"← Prev"}),(0,s.jsx)("button",{onClick:()=>p(Math.min(n.length-1,x+1)),disabled:x===n.length-1,className:"px-3 py-2 bg-gray-300 text-gray-900 rounded hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next →"})]})]}),A.positioned?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{ref:N,className:"w-full overflow-hidden",style:{height:400*v},children:(0,s.jsx)("div",{className:"border-2 border-gray-400 bg-gradient-to-b from-amber-100 to-amber-50 relative",style:{width:400,height:400,backgroundImage:"\n                        linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),\n                        linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px)\n                      ",backgroundSize:"".concat(40,"px ").concat(40,"px"),transform:"scale(".concat(v,")"),transformOrigin:"top left"},children:k.map(e=>{let t=e.student_id===r;return(0,s.jsx)("div",{className:"absolute flex items-center justify-center",style:{left:40*e.x,top:40*e.y,width:40,height:40},children:(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 ".concat(t?"bg-green-500 border-green-600":"bg-blue-500 border-blue-600"),children:w(t?a:e.student_name)})},"".concat(e.student_id,"-").concat(e.x,"-").concat(e.y))})})}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Your position: Grid (",A.x,", ",A.y,")"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Other students are shown in blue. Your circle is green."})]}):(0,s.jsx)("div",{className:"p-8 bg-gray-50 rounded-lg text-center",children:k.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"You are not positioned for this part yet."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Other student positions are still shown below."}),(0,s.jsx)("div",{ref:N,className:"w-full overflow-hidden mt-4",style:{height:400*v},children:(0,s.jsx)("div",{className:"border-2 border-gray-400 bg-gradient-to-b from-amber-100 to-amber-50 relative",style:{width:400,height:400,backgroundImage:"\n                            linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),\n                            linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px)\n                          ",backgroundSize:"".concat(40,"px ").concat(40,"px"),transform:"scale(".concat(v,")"),transformOrigin:"top left"},children:k.map(e=>{let t=e.student_id===r;return(0,s.jsx)("div",{className:"absolute flex items-center justify-center",style:{left:40*e.x,top:40*e.y,width:40,height:40},children:(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 ".concat(t?"bg-green-500 border-green-600":"bg-blue-500 border-blue-600"),children:w(e.student_name)})},"".concat(e.student_id,"-").concat(e.x,"-").concat(e.y))})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"You are not positioned for this part yet."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Check back after rehearsal when positioning is complete."})]})})]})})]})]})}var c=r(1517),m=r(1776),u=r(9157);function x(){let[e,t]=(0,i.useState)("browse"),[r,a]=(0,i.useState)(null),{performances:d,loading:o}=(0,l.f)();return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("nav",{className:"bg-green-900 text-white p-4 shadow-lg",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[(0,s.jsx)(c.AppBrand,{href:"/"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(n(),{href:"/",className:"hover:bg-green-800 px-3 py-2 rounded",children:"Home"}),(0,s.jsx)("span",{className:"px-3 py-2 bg-green-800 rounded",children:"Student Signup"})]})]})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Browse Performances"}),(0,s.jsx)("p",{className:"text-gray-600",children:"View performance details, upcoming rehearsals, and uniform information."})]}),(0,s.jsxs)("div",{className:"flex gap-4 mb-8",children:[(0,s.jsx)("button",{onClick:()=>t("browse"),className:"px-6 py-3 rounded-lg font-semibold transition-colors ".concat("browse"===e?"bg-green-600 text-white":"bg-white text-gray-900 hover:bg-gray-50"),children:"Browse Performances"}),(0,s.jsx)("button",{onClick:()=>t("mySignups"),className:"px-6 py-3 rounded-lg font-semibold transition-colors ".concat("mySignups"===e?"bg-green-600 text-white":"bg-white text-gray-900 hover:bg-gray-50"),children:"My Sign-ups"}),(0,s.jsx)("button",{onClick:()=>t("schedule"),className:"px-6 py-3 rounded-lg font-semibold transition-colors ".concat("schedule"===e?"bg-green-600 text-white":"bg-white text-gray-900 hover:bg-gray-50"),children:"Schedule"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8",children:["browse"===e&&(0,s.jsx)(p,{performances:d,loading:o,selectedPerformanceId:r,onSelectPerformance:a}),"mySignups"===e&&(0,s.jsx)(h,{}),"schedule"===e&&(0,s.jsx)(m.z,{title:"Performance Schedule",accent:"green"})]})]})]})}function p(e){let{performances:t,loading:r,selectedPerformanceId:a,onSelectPerformance:n}=e,[l,d]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),[m,x]=(0,i.useState)([]),[p,h]=(0,i.useState)(!1);(0,i.useEffect)(()=>{a&&g(a)},[a]);let g=async e=>{try{let t=await fetch("/api/performances/".concat(e));if(!t.ok)throw Error("Failed to fetch details");let r=await t.json();c(r),d(null),h(!0);try{let[t,r]=await Promise.all([fetch("/api/uniform-items"),fetch("/api/uniform-types")]),s=await t.json(),a=await r.json(),n=new Map((Array.isArray(a)?a:[]).map(e=>[e.id,e.name])),i=[];(Array.isArray(s)?s:[]).forEach(t=>{let r=n.get(t.uniform_type_id)||"Uniform";(Array.isArray(t.uniform_assignments)?t.uniform_assignments:[]).filter(t=>t.performance_id===e).forEach(e=>{i.push({item_number:t.item_number,type_name:r,status:e.returned_at?"Returned":"Assigned",student_name:e.student_name||null})})}),x(i)}catch(e){console.warn("Failed to load uniform info:",e),x([])}finally{h(!1)}}catch(e){d(e instanceof Error?e.message:"An error occurred"),c(null)}};if(r)return(0,s.jsx)("div",{className:"text-center py-12 text-gray-600",children:"Loading performances..."});if(0===t.length)return(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"No performances available at the moment."}),(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"Check back soon for upcoming events!"})]});let f=(0,u.so)(new Date().toISOString(),"America/New_York");return(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Available Performances"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"space-y-3",children:t.map(e=>{let t=(null==e?void 0:e.date)?(0,u.so)(e.date,e.timezone||"America/New_York"):"",r=!t||!f||t>=f;return(0,s.jsxs)("button",{onClick:()=>n(e.id),className:"w-full p-4 text-left border-2 rounded-lg transition-colors ".concat(a===e.id?"border-green-600 bg-green-50":"border-gray-200 hover:border-green-400"," ").concat(r?"":"opacity-60"),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.title}),r?(0,s.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full bg-green-100 text-green-700 border border-green-200",children:(0,u.$H)(e.date,e.timezone||"America/New_York")}):(0,s.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full bg-gray-100 text-gray-500 border border-gray-200",children:(0,u.$H)(e.date,e.timezone||"America/New_York")})]}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-2",children:(0,s.jsxs)("div",{children:["\uD83D\uDCCD ",e.location]})})]},e.id)})}),(0,s.jsx)("div",{children:a?(0,s.jsxs)("div",{className:"p-6 bg-gray-50 rounded-lg border-2 border-green-200 space-y-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Performance Information"}),l&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:l}),o&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Performance Date"}),(0,s.jsx)("div",{className:"font-semibold text-gray-900",children:(0,u.$H)(o.date,o.timezone||"America/New_York")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Location"}),(0,s.jsx)("div",{className:"font-semibold text-gray-900",children:o.location||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Contact"}),(0,s.jsx)("div",{className:"font-semibold text-gray-900",children:Array.isArray(o.phone_numbers)?o.phone_numbers.join(", "):o.phone_numbers||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Upcoming Rehearsals"}),Array.isArray(o.rehearsals)&&o.rehearsals.length>0?(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:o.rehearsals.map(e=>{let t=e.date?(0,u.so)(e.date,o.timezone||"America/New_York"):"",r=(0,u.so)(new Date().toISOString(),"America/New_York");return(0,s.jsxs)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full border ".concat(t&&r&&!(t>=r)?"bg-gray-100 text-gray-500 border-gray-200":"bg-green-100 text-green-700 border-green-200"),children:[e.date?(0,u.$H)(e.date,o.timezone||"America/New_York"):"Date TBD",e.time?" • ".concat((0,u.a7)(e.time)," ET"):"",e.location?" • ".concat(e.location):""]},e.id)})}):(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-2",children:"No rehearsals scheduled yet."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Uniform Info"}),p?(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-2",children:"Loading uniform info..."}):m.length>0?(0,s.jsx)("div",{className:"mt-2 space-y-2 text-sm text-gray-700",children:m.map((e,t)=>(0,s.jsxs)("div",{children:[e.type_name," ",e.item_number," • ",e.status,e.student_name?" (Assigned to ".concat(e.student_name,")"):""]},"".concat(e.item_number,"-").concat(t)))}):(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-2",children:"No uniforms assigned for this performance yet."})]})]})]}):(0,s.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg text-center text-gray-600",children:(0,s.jsx)("p",{children:"Select a performance to view details"})})})]})]})}function h(e){let{}=e,[t,r]=(0,i.useState)(""),[a,n]=(0,i.useState)([]),[l,d]=(0,i.useState)([]),[o,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(!1),[x,p]=(0,i.useState)([]),[h,f]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[j,N]=(0,i.useState)(!1),[v,_]=(0,i.useState)([]),w=(0,i.useCallback)(async()=>{y(null),f(!0);try{let e=t.trim().toLowerCase(),r=a.filter(t=>t.name.toLowerCase().includes(e)),s=a.find(t=>t.name.toLowerCase()===e),n=m?r:o?a.filter(e=>e.id===o):s?[s]:1===r.length?r:[];if(0===n.length){y("Select a student from the suggestions or enable 'Show all matches'."),p([]),_([]);return}let i=(await Promise.all(n.map(async e=>{let t=await fetch("/api/signups?studentId=".concat(e.id));return await t.json()||[]}))).flat(),l=await Promise.all(i.map(async e=>{let t=await fetch("/api/performances/".concat(e.performance_id)),r=await t.json();return{...e,performance:r}}));p(l),_(n.map(e=>e.name))}catch(e){y(e instanceof Error?e.message:"Failed to fetch signups")}finally{f(!1)}},[t,a,m,o]);(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/students"),t=await e.json();n(t||[])}catch(e){n([])}})()},[]),(0,i.useEffect)(()=>{let e=t.trim().toLowerCase();if(!e){d([]),c(null);return}let r=a.filter(t=>t.name.toLowerCase().includes(e));d(r),1===r.length&&c(r[0].id)},[t,a]),(0,i.useEffect)(()=>{t.trim()&&(j||N(!0),w())},[j,t,o,m,w]);let S=async e=>{if(e.preventDefault(),N(!0),!t.trim())return void y("Please enter your name");await w()};return(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"View Your Sign-ups"}),(0,s.jsxs)("form",{onSubmit:S,className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:t,onChange:e=>{r(e.target.value),c(null)},placeholder:"Enter your full name",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 font-semibold",children:h?"Searching...":"Search"})]}),l.length>1&&(0,s.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:l.slice(0,6).map(e=>(0,s.jsx)("label",{className:"px-3 py-1 rounded-full text-xs border cursor-pointer ".concat(o===e.id?"bg-green-600 text-white border-green-700":"bg-white text-gray-700 border-gray-300"),onClick:()=>{c(e.id),N(!0)},children:e.name},e.id))}),l.length>1&&(0,s.jsxs)("label",{className:"mt-3 inline-flex items-center gap-2 text-sm text-gray-700",children:[(0,s.jsx)("input",{type:"checkbox",checked:m,onChange:e=>u(e.target.checked)}),"Show performances for all matching names"]})]}),b&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:b}),v.length>0&&(0,s.jsxs)("div",{className:"mb-4 text-sm text-gray-600",children:["Showing performances for:"," ",(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:v.join(", ")})]}),j?h?(0,s.jsx)("div",{className:"text-center py-12 text-gray-600",children:"Loading..."}):0===x.length?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-600",children:"You haven't signed up for any performances yet."})}):(0,s.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,s.jsx)(g,{signup:e,studentName:t},e.id))}):(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,s.jsx)("p",{children:"Enter your name above to view your sign-ups"})})]})}function g(e){var t,r,a,n,l;let{signup:d,studentName:c}=e,[m,x]=(0,i.useState)([]),[p,h]=(0,i.useState)(!0),[g,f]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1),[j,N]=(0,i.useState)(null),[v,_]=(0,i.useState)(null),[w,S]=(0,i.useState)(null),[A,k]=(0,i.useState)(null),[C,P]=(0,i.useState)(null),[I,D]=(0,i.useState)(null),[E,Y]=(0,i.useState)(null),[z,T]=(0,i.useState)(null),[U,M]=(0,i.useState)(!1),L=(0,i.useRef)(null),O=(null==(t=d.performance)?void 0:t.music_file_path)?"".concat("https://quqvudqzztlmgrwqudho.supabase.co","/storage/v1/object/public/performance-music/").concat(d.performance.music_file_path):"",F=e=>{if(null==e)return null;let t="number"==typeof e?e:Number(e);if(!Number.isFinite(t))return null;let r=Math.floor(t/60),s=Math.floor(t%60);return"".concat(r,":").concat(String(s).padStart(2,"0"))},H=(e,t)=>{let r=F(e),s=F(t);return r||s?r&&s?"".concat(r," - ").concat(s):r||s:null},R=(0,i.useCallback)(async()=>{try{var e,t,r,s,a,n,i,l,o,m;h(!0),N(null),_(null),S(null),k(null),P(null),D(null),Y(null),T(null),M(!1);let p=await fetch("/api/performances/".concat(d.performance_id)),g=await p.json();if(!g.parts||0===g.parts.length)return void x([]);let f=d.part_id?(g.parts||[]).find(e=>e.id===d.part_id):null,b=f?H(f.timepoint_seconds,f.timepoint_end_seconds):null,y=null,j=[];try{let e=await fetch("/api/rehearse-notes?performanceId=".concat(d.performance_id)),t=await e.json();Array.isArray(t)&&(j=t.map(e=>{var t;return{part_id:e.part_id,subpart_id:null!=(t=e.subpart_id)?t:null,note:e.note}}))}catch(e){console.warn("Failed to load rehearse notes:",e)}if(f){f.description&&P(f.description);let e=await fetch("/api/subparts?partId=".concat(f.id)),t=await e.json();if(Array.isArray(t)&&t.length>0)for(let e of t){let t=await fetch("/api/subpart-order?subpartId=".concat(e.id)),r=await t.json();if(Array.isArray(r)&&r.some(e=>e.student_id===d.student_id)){y=e.title||"Subpart",e.description&&D(e.description);let t=H(e.timepoint_seconds,e.timepoint_end_seconds);t&&(b=t);let r=j.find(t=>t.part_id===f.id&&t.subpart_id===e.id);(null==r?void 0:r.note)&&k(r.note);break}}let r=j.find(e=>e.part_id===f.id&&null===e.subpart_id);(null==r?void 0:r.note)&&S(r.note)}if(N(b),_(y),d.assigned_uniform_item_id)try{let[a,n,i]=await Promise.all([fetch("/api/uniform-items"),fetch("/api/uniform-types"),fetch("/api/performances")]),l=await a.json(),o=await n.json(),m=await i.json(),x=new Map((Array.isArray(o)?o:[]).map(e=>[e.id,e.name])),p=new Map((Array.isArray(m)?m:[]).map(e=>[e.id,{title:e.title||e.name||e.id,date:e.date||null}])),h=(Array.isArray(l)?l:[]).find(e=>e.id===d.assigned_uniform_item_id);if(h){let a=x.get(h.uniform_type_id)||"Uniform",n=(h.uniform_assignments||[]).filter(e=>e.performance_id===d.performance_id).slice().sort((e,t)=>{let r=new Date(e.distributed_at||e.returned_at||0).getTime();return new Date(t.distributed_at||t.returned_at||0).getTime()-r})[0],i="Assigned";(null==n?void 0:n.returned_at)?i="Returned":(null==n?void 0:n.distributed_at)&&(i="Distributed"),Y("".concat(a," #").concat(h.item_number," (").concat(i,")"));let l=(null==(e=d.performance)?void 0:e.date)?new Date(d.performance.date).getTime():null,o=null!=l?l:Date.now(),m=(h.uniform_assignments||[]).filter(e=>e.performance_id&&!e.returned_at).map(e=>{let t=p.get(e.performance_id),r=(null==t?void 0:t.date)?new Date(t.date).getTime():null;return{assignment:e,perfInfo:t,perfTime:r}}).filter(e=>null!==e.perfTime&&e.perfTime>o).sort((e,t)=>e.perfTime-t.perfTime);if(m.length>0){let e=m[0],a=(null==(t=e.perfInfo)?void 0:t.title)||"Performance",n=(null==(r=e.perfInfo)?void 0:r.date)?(0,u.$H)(e.perfInfo.date,(null==(s=d.performance)?void 0:s.timezone)||"America/New_York"):"";e.assignment.student_id===d.student_id?T("".concat(c," is assigned for ").concat(a).concat(n?" (".concat(n,")"):""," coming up.")):(T("Uniform must be returned after this performance. Next use: ".concat(a).concat(n?" (".concat(n,")"):""," is assigned to ").concat(e.assignment.student_name||"another student",".")),M(!0))}}}catch(e){console.warn("Failed to load uniform info:",e)}let v=async e=>{try{let t=await fetch("/api/subparts?partId=".concat(e)),r=await t.json();if(!Array.isArray(r)||0===r.length)return null;for(let e of r){let t=await fetch("/api/subpart-order?subpartId=".concat(e.id)),r=await t.json();if(Array.isArray(r)&&r.some(e=>e.student_id===d.student_id))return{title:e.title||"Subpart",time:H(e.timepoint_seconds,e.timepoint_end_seconds),start:"number"==typeof e.timepoint_seconds?e.timepoint_seconds:null}}return null}catch(e){return console.warn("Failed to resolve subpart time:",e),null}},w=[];for(let e of g.parts){let t=await fetch("/api/stage-positions?partId=".concat(e.id)),r=await t.json(),s=r.some(e=>e.student_id===d.student_id),c=H(e.timepoint_seconds,e.timepoint_end_seconds),u=await fetch("/api/subparts?partId=".concat(e.id)),x=await u.json(),p=Array.isArray(x)?x.slice().sort((e,t)=>{let r="number"==typeof e.timepoint_seconds?e.timepoint_seconds:1/0,s="number"==typeof t.timepoint_seconds?t.timepoint_seconds:1/0;return r!==s?r-s:(e.title||"").localeCompare(t.title||"")}):[],h=p.length>0?p.map((e,t)=>"".concat(t+1,") ").concat(e.title)).join(", "):null,g=await v(e.id),f="number"==typeof e.timepoint_seconds?e.timepoint_seconds:null;if(s){let t=r.find(e=>e.student_id===d.student_id);w.push({part_name:e.name,x:t.x,y:t.y,positioned:!0,part_time:c,subpart_time:null!=(a=null==g?void 0:g.time)?a:null,subpart_title:null!=(n=null==g?void 0:g.title)?n:null,part_start:f,subpart_start:null!=(i=null==g?void 0:g.start)?i:null,subparts_list:h})}else w.push({part_name:e.name,positioned:!1,part_time:c,subpart_time:null!=(l=null==g?void 0:g.time)?l:null,subpart_title:null!=(o=null==g?void 0:g.title)?o:null,part_start:f,subpart_start:null!=(m=null==g?void 0:g.start)?m:null,subparts_list:h})}x(w)}catch(e){console.error("Error fetching positioning:",e)}finally{h(!1)}},[d.performance_id,d.student_id]);return((0,i.useEffect)(()=>{R()},[R]),b)?(0,s.jsxs)("div",{className:"border border-green-200 rounded-lg bg-white overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-6 bg-green-50 border-b border-green-200 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-bold text-lg text-gray-900",children:(null==(l=d.performance)?void 0:l.title)||"Performance"}),(0,s.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 bg-gray-300 text-gray-900 rounded hover:bg-gray-400",children:"← Back to Signups"})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(o,{performanceId:d.performance_id,studentId:d.student_id,studentName:c})})]}):(0,s.jsxs)("div",{className:"border border-green-200 rounded-lg bg-green-50 overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>f(!g),className:"w-full p-6 text-left hover:bg-green-100 transition-colors",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h3",{className:"font-bold text-lg text-gray-900",children:["Performance: ",(null==(r=d.performance)?void 0:r.title)||"Unknown"]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[(0,s.jsxs)("div",{children:["\uD83D\uDCC5 Date: ",(null==(a=d.performance)?void 0:a.date)?(0,u.$H)(d.performance.date,d.performance.timezone||"America/New_York"):"N/A"]}),(0,s.jsxs)("div",{children:["\uD83D\uDCCD Location: ",(null==(n=d.performance)?void 0:n.location)||"N/A"]}),(0,s.jsxs)("div",{children:["Status: ",(0,s.jsx)("span",{className:"capitalize px-2 py-1 bg-green-200 rounded text-green-900 text-xs font-semibold",children:d.status})]})]})]}),(0,s.jsx)("div",{className:"text-2xl text-gray-600",children:g?"▼":"▶"})]})}),g&&(0,s.jsxs)("div",{className:"border-t border-green-200 p-6 bg-white",children:[d.part&&(0,s.jsxs)("div",{className:"mb-4 pb-4 border-b border-green-200",children:[(0,s.jsx)("span",{className:"font-semibold text-gray-700",children:"Signed Up For Part:"})," ",(0,s.jsx)("span",{className:"text-gray-600 font-medium",children:d.part}),(v||j)&&(0,s.jsxs)("div",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[v&&(0,s.jsxs)("div",{children:["Subpart: ",(0,s.jsx)("span",{className:"font-medium text-gray-800",children:v})]}),j&&(0,s.jsxs)("div",{children:["Time: ",(0,s.jsx)("span",{className:"font-medium text-gray-800",children:j})]})]}),(A||w||I||C)&&(0,s.jsxs)("div",{className:"mt-3 text-sm text-gray-600 space-y-2",children:[A&&(0,s.jsxs)("div",{children:["Subpart Note:"," ",(0,s.jsx)("span",{className:"font-medium text-gray-800",children:A})]}),w&&(0,s.jsxs)("div",{children:["Part Note: ",(0,s.jsx)("span",{className:"font-medium text-gray-800",children:w})]}),I&&(0,s.jsxs)("div",{children:["Subpart Notes:"," ",(0,s.jsx)("span",{className:"font-medium text-gray-800",children:I})]}),C&&(0,s.jsxs)("div",{children:["Part Notes:"," ",(0,s.jsx)("span",{className:"font-medium text-gray-800",children:C})]})]})]}),(E||z)&&(0,s.jsxs)("div",{className:"mb-4 pb-4 border-b border-green-200",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Uniform Assignment"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[11px] text-gray-500 uppercase",children:"Name"}),(0,s.jsx)("div",{className:"font-medium text-gray-900",children:c||"Student"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[11px] text-gray-500 uppercase",children:"Uniform"}),(0,s.jsx)("div",{className:"font-medium text-gray-800",children:E||"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[11px] text-gray-500 uppercase",children:"Next Use"}),z?(0,s.jsx)("div",{className:U?"mt-1 border-2 border-red-500 bg-red-50 text-red-700 rounded px-3 py-2 text-xs shadow-[0_0_12px_rgba(239,68,68,0.6)] animate-pulse":"mt-1 text-xs text-gray-700",children:z}):(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"\xa0"})]})]})]}),m.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-700 mb-3",children:"Your Positioning for Each Part:"}),(0,s.jsx)("div",{className:"space-y-2 mb-4",children:m.map((e,t)=>(0,s.jsxs)("div",{className:"text-sm text-gray-600 p-2 bg-gray-50 rounded",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("span",{className:"font-medium text-gray-900",children:[t+1,". ",e.part_name]}),e.part_time&&(0,s.jsxs)("span",{className:"text-xs font-semibold text-gray-700",children:["Time: ",e.part_time]}),e.subpart_time&&(0,s.jsxs)("span",{className:"text-xs font-semibold text-blue-700",children:[e.subpart_title||"Subpart",": ",e.subpart_time]})]})," ",e.subparts_list&&(0,s.jsxs)("div",{className:"mt-1 text-[10px] text-gray-600",children:["Subparts: ",e.subparts_list]}),(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[O&&e.part_time&&null!==e.part_start&&(0,s.jsx)("button",{type:"button",onClick:()=>{L.current&&(L.current.currentTime=e.part_start,L.current.play())},className:"px-2 py-1 rounded bg-gray-800 text-white",children:"Play Part"}),O&&e.subpart_time&&null!==e.subpart_start&&(0,s.jsx)("button",{type:"button",onClick:()=>{L.current&&(L.current.currentTime=e.subpart_start,L.current.play())},className:"px-2 py-1 rounded bg-blue-600 text-white",children:"Play Subpart"}),e.subpart_time&&(0,s.jsx)("span",{className:"text-[10px] text-gray-500",children:"Play Part = full part timestamp • Play Subpart = your assigned subpart"})]}),e.positioned?(0,s.jsxs)("span",{className:"text-green-700 font-semibold",children:["✓ Grid position (",e.x,", ",e.y,")"]}):(0,s.jsx)("span",{className:"text-gray-500",children:"Not positioned yet"})]},t))}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold",children:"View Positioning Grid →"}),(0,s.jsx)("button",{onClick:()=>{let e="/api/rehearse-export?performanceId=".concat(d.performance_id,"&embedAudio=1");window.open(e,"_blank","noopener,noreferrer")},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-semibold",children:"Open Rehearse Mode"})]}),(0,s.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Note: Rehearse Mode downloads an HTML file and should be run on a computer."})]}),(0,s.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Music"}),O?(0,s.jsx)("audio",{ref:L,controls:!0,className:"w-full",children:(0,s.jsx)("source",{src:O})}):(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"No music uploaded for this performance yet."})]})]})]})}},9405:(e,t,r)=>{Promise.resolve().then(r.bind(r,8318))}},e=>{e.O(0,[5481,2590,8441,1255,7358],()=>e(e.s=9405)),_N_E=e.O()}]);